### 信用卡转账支付

#### 接口信息
接口名称：CreditCardService.transferPay
接口中文名：信用卡转账支付
功能说明：提供信用卡进行转账支付功能，支持信用卡进行本异地、外币转账交易，交易时需要对用户信息、卡片信息进行检查。

#### 请求路径
|环境   |地址   |
|-------|-------|
|功能环境|https://xxxxx.icbc.sdc.com.cn/api/creditcard/transferPay/V1 |

#### 通用请求参数
|参数名	 |类型	 |是否必输 |最大长度 | 描述   |示例值 |
|-------|-------|-------|-------|-------|-------|
|chk_name_flag|string|是|1|姓名检查标志，0-不检查，1-检查|1|
|person_name|string|否|60|用户姓名，当姓名检查标志为1时需上送|张三|
|transfer_amount|bigdecimal|是|10|转账金额|1.00|
|fee_type|string|否|1|手续费类型，0-无手续费，1-收取异地手续费|0|
|transfer_currency_type|string|是|1|转账币种类型，0-人民币，1-外币|0|
|transfer_currency|int|是|3|转账币种，156-CNY,840-USD|156|
|chk_local_flag|string|否|1|是否支持异地卡处理标志，0-不支持，1-支持|1|
|over_flag|string|否|1|透支标志，0-不透支，1-透支|1|
|counterParams|object|是|-|对方账户信息参数|-|
| ├─ counter_account|string|是|20|对方账号|1234567890|
| ├─ field1 | string |否| 信息1 |--|
| ├─ field2 | string |否| 信息2 |--|
|cardChkParams|object|是|-|卡检查参数|-|
| ├─ card_no|string|是|19|卡号|6226220000000000|
| ├─ card_pin_chk_flag|string|否|1|卡密码检查标志，0-不检查，1-检查|1|
| ├─ card_pin|string|否|6|卡密码|123456|
| ├─ card_expired_flag|string|否|1|卡有效期检查标志，0-不检查，1-检查|1|
| ├─ card_expired_date|string|否|6|卡片有效期|202701|
|InfoParams|object|是|-|交易信息参数|-|
| ├─ trx_zoneno|int|是|5|交易地区|200|
| ├─ trx_workdate|Date|是|10|交易日期|yyyy-MM-dd|
| ├─ trx_time|Time|是|8|交易时间|HH:mm:ss|
|cerChkParams|object|否|-|身份检查参数|-|
| ├─ cer_chk|string|否|1|证件检查标志，0-不检查，1-检查|1|
| ├─ cer_type|string|否|3|证件类型，0-身份证，1-护照，3-港澳台通行证|0|
| ├─ cer_no|string|否|20|证件号码|441323200001010098|

#### 请求头
|参数名	|类型 |是否必输|最大长度|描述|示例值|
|-------|-------|-------|-----|-------|-------|
|X-Request-App|string|是|10|请求应用名|F-CCPS|
|X-Request-Id|string|是|10|请求应用号|2010434|

#### 通用响应参数
|参数名	|类型 |是否必输|最大长度|描述|示例值|
|-------|-------|-------|-------|-------|-------|
|return_code|string|是|10|交易返回码，成功返回0，失败返回错误码|ERR1003|
|return_msg|string|是|200|错误码说明，交易成功是为空，交易失败时为错误码说明|校验身份信息失败|
|trx_serno|string|是|20|交易序号|233344455|
|card_no|string|是|19|卡号|6226220000000000|
|usable_amount|bigdecimal|是|10|余额|100.00|
|over_amount|bigdecimal|是|10|透支金额|0.00|
|data | object |否|返回对象 |--|
| ├─ field1 | string |是| 信息1 |--|
| ├─ field2 | object |否| 信息2 |--|
| │  ├─ sub_field1 | int |是| 子信息1 |--|
| │  └─ sub_field2 | bool |否| 子信息2 |--|
| └─ field3 | string |是| 信息3 |--|


#### 请求示例
```json
{
  "chk_name_flag": "1",
  "person_name": "张三",
  "transfer_amount": 1.00,
  "fee_type": "0",
  "transfer_currency_type": "0",
  "transfer_currency": 156,
  "chk_local_flag": "1",
  "over_flag": "1",
  "counterParams": {
    "counter_account": "1234567890"
  },
  "cardChkParams": {
    "card_no": "6226220000000000",
    "card_pin_chk_flag": "1",
    "card_pin": "123456",
    "card_expired_flag": "1",
    "card_expired_date": "202701"
  },
  "InfoParams": {
    "trx_zoneno": 200,
    "trx_workdate": "2025-07-21",
    "trx_time": "15:30:00"
  },
  "cerChkParams": {
    "cer_chk": "1",
    "cer_type": "0",
    "cer_no": "441323200001010098"
  }
}
```

#### 成功响应示例
```json
{
  "return_code": "0",
  "return_msg": "",
  "trx_serno": "233344455",
  "card_no": "6226220000000000",
  "usable_amount": 100.00,
  "over_amount": 0.00,
  "data": {
    "field1": "value1",
    "field2": {
      "sub_field1": 100,
      "sub_field2": true
    },
    "field3": "value3"
  }
}
```

#### 异常响应示例
```json
{
  "return_code": "ERR1001",
  "return_msg": "余额不足",
  "trx_serno": "233344455",
  "card_no": "6226220000000000",
  "usable_amount": 0.00,
  "over_amount": 0.00,
  "data": null
}
```

#### 错误码
|错误码|说明|
|-------|-------|
|ERR1001|余额不足|
|ERR1002|不支持异地交易|
|ERR1003|校验身份信息失败|
|ERR1004|该卡不存在|
|ERR1005|该卡已销户|

#### 场景分支

##### 场景分支1
场景分支说明：信用卡转账支付-基准分支。若无特殊测试场景，则使用该分支，默认覆盖内容：本地人民币交易，支持透支，无手续费。

场景分支执行步骤：
1. 确定交易地区，默认为200地区；确定转账金额，默认转账金额为1.00；按json格式进行填充，以下为示例：
   ```json
   {
        "transfer_amount": 1.00,
        "InfoParams": {
            "trx_zoneno": 200,
        }
   }
   ```
2. 在信用卡信息表里，查找一张开卡地区为200，且可用余额大于转账金额的信用卡，获取卡号和户名；按json格式进行填充，以下为示例：
   ```json
   {
        "person_name": "张三",
        "cardChkParams": {
            "card_no": "6226220000000000",
        }
   }
   ```
3. 获取接口默认交易报文，并将交易地区、转账金额、卡号和户名信息更改为上述步骤获取的信息；
4. 发送接口请求，获取响应参数；
5. 验证响应参数，响应参数返回码应该为0，交易成功。
6. 验证交易正确性，查看交易后可用余额是否正确。交易后按卡号查信用卡信息表，获取可用余额，将交易前后可用余额进行对比，差值应为转账金额。例如，交易前可用余额为100.00，转账金额为1.00，交易后可用余额应为99.00。

##### 场景分支2
场景分支说明：信用卡转账支付-异地交易

场景分支执行步骤：
1. 确定交易地区，例如200地区；确定是否支持异地卡处理标志，需要支持异地卡处理，参数设置为1；确定转账金额，例如1.00；
   ```json
   {
        "transfer_amount": 1.00,
        "chk_local_flag": "1",
        "InfoParams": {
            "trx_zoneno": 200,
        }
   }
   ```
2. 在信用卡信息表里，查找一张开卡地区不为200，且可用余额大于转账金额的信用卡，获取卡号；
   ```json
   {
        "person_name": "李四",
        "cardChkParams": {
            "card_no": "6226220000000001",
        }
   }
   ```
3. 获取接口默认交易报文，并将以上步骤获取的信息替换到交易报文中；
4. 发送接口请求，获取响应参数；
5. 验证响应参数，响应参数返回码应为0，交易成功；返回参数返回码非0，则交易失败。
6. 验证交易正确性，查看交易后可用余额是否正确。交易后按卡号查信用卡信息表，获取可用余额，将交易前后可用余额进行对比，差值应为转账金额。例如，交易前可用余额为100.00，转账金额为1.00，交易后可用余额应为99.00。

##### 场景分支3
场景分支说明：信用卡转账支付-外币交易

场景分支执行步骤：
1. 确定外币币种，例如美元代码840；确定转账币种类型，需要使用外币，参数设置为1；确定转账金额，例如1.00；
   ```json
   {
        "transfer_amount": 1.00,
        "transfer_currency_type": "1",
        "transfer_currency": 840,
   }
   ```
2. 获取接口默认交易报文，并将以上步骤获取的信息替换到交易报文中；
3. 发送接口请求，获取响应参数；
4. 验证响应参数，响应参数返回码应为0，交易成功；返回参数返回码非0，则交易失败。
5. 验证交易正确性，查看交易后可用余额是否正确。交易后按卡号查信用卡信息表，获取可用余额，将交易前后可用余额进行对比，差值应为转账金额。例如，交易前可用余额为100.00，转账金额为1.00，交易后可用余额应为99.00。

##### 场景分支4
场景分支说明：信用卡转账支付-收取手续费分支

场景分支执行步骤：
1. 确定手续费类型，参数设置为1-异地手续费；确定交易地区，例如200地区；确定是否支持异地卡处理标志，需要支持异地卡处理，参数设置为1；确定转账金额，例如10.00；
   ```json
   {
        "transfer_amount": 10.00,
        "fee_type": "1",
        "chk_local_flag": "1",
        "InfoParams": {
            "trx_zoneno": 200,
        }
   }
   ```
2. 在信用卡信息表里，查找一张开卡地区不为200，且可用余额大于转账金额的信用卡，获取卡号和户名；
   ```json
   {
        "person_name": "李四",
        "cardChkParams": {
            "card_no": "6226220000000001",
        }
   }
   ```
3. 获取接口默认交易报文，并将以上步骤获取的信息替换到交易报文中；
4. 发送接口请求，获取响应参数；
5. 验证响应参数，响应参数返回码应为0，交易成功；返回参数返回码非0，则交易失败。
6. 验证交易正确性，查看交易后可用余额是否正确。交易后按卡号查信用卡信息表，获取可用余额，将交易前后可用余额进行对比，差值应为转账金额+手续费金额。例如，交易前可用余额为100.00，转账金额为10.00，手续费金额为1.00，交易后可用余额应为89.00。

##### 场景分支5
场景分支说明：信用卡转账支付-不透支场景分支

场景分支执行步骤：
1. 需要设置透支类型为0-不透支；
   ```json
   {
        "over_flag": "0",
   }
   ```
2. 在信用卡信息表里，查找一张溢缴款金额大于1的信用卡，获取卡号、户名、开卡地区信息；
   ```json
   {
        "person_name": "张三",
        "cardChkParams": {
            "card_no": "6226220000000001",
        },
        "InfoParams": {
            "trx_zoneno": 200,
        }
   }
3. 获取接口默认交易报文，并将以上步骤获取的信息替换到交易报文中；
4. 发送接口请求，获取响应参数；
5. 验证响应参数，响应参数返回码应为0，交易成功；返回参数返回码非0，则交易失败。
6. 验证交易正确性，查看交易后可用余额是否正确。根据卡号查找信用卡信息表，获取该卡的可用余额和溢缴款字段，可用余额应为0，溢缴款额度应为交易前金额减去交易金额。例如，交易前，可用余额

##### 场景分支6
场景分支说明：信用卡转账支付-卡检查分支

场景分支执行步骤：
1. 需要上送卡检查参数，设置卡密码检查标志为1，设置卡片有效期检查标志为1。
   ```json
   {
        "cardChkParams": {
            "card_pin_chk_flag": "1",
            "card_expired_flag": "1",
        },
   }
    ```
2. 在信用卡信息表里，查找一张状态正常的信用卡，获取卡号、密码和过期时间；
   ```json
   {
        "cardChkParams": {
            "card_no": "6226220000000000",
            "card_pin": "123456",
            "card_expired_date": "202701"
        },
   }
    ```
3. 获取接口默认交易报文，并将以上步骤获取的信息替换到交易报文中；
4. 发送接口请求，获取响应参数；
5. 验证响应参数，响应参数返回码应为0，交易成功；返回参数返回码非0，则交易失败。
6. 验证交易正确性，查看交易后可用余额是否正确。交易前后可用余额进行对比，差值应为转账金额。例如，交易前可用余额为100.00，转账金额为1.00，交易后可用余额应为99.00。

##### 场景分支7
场景分支说明：信用卡转账支付-客户身份检查分支

场景分支执行步骤：
1. 需要上送客户身份检查参数，设置客户身份检查标志为1；
    ```json
    {
        "cerChkParams": {
            "cer_chk": "1",
        }
    }
    ```
2. 在信用卡信息表里，查找一张状态正常的卡，获取卡号、用户编号信息；再使用用户编号信息，查询用户信息表，获取用户姓名，证件类型和证件号码信息；
    ```json
    {    
        "person_name": "张三",
        "cardChkParams": {
            "card_no": "6226220000000000",
        },
        "cerChkParams": {
            "cer_type": "0",
            "cer_no": "441323200001010098"
        }
    }
    ```
3. 获取接口默认交易报文，并将交易地区、转账金额和卡号信息更改为上述步骤获取的信息；
4. 发送接口请求，获取响应参数；
5. 验证响应参数，响应参数返回码应为0，交易成功；返回参数返回码非0，则交易失败。
6. 验证交易正确性，查看交易后可用余额是否正确。例如，交易前可用余额为100.00，转账金额为1.00，交易后可用余额应为99.00。